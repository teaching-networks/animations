<section *restricted class="user-management">
	<h2>User Management</h2>

	<material-button raised (click)="openUserCreateDialog()">
		Add user&nbsp;
		<material-icon icon="add_circle"></material-icon>
	</material-button>

	<div *ngIf="users == null" class="centered-panel">
		<material-spinner></material-spinner>
	</div>

	<div *ngIf="users != null" class="user-list">

		<h3 *ngIf="users.isEmpty">
			There are no users yet. Try creating one!
		</h3>

		<div *ngFor="let user of users" class="user-card">
			<span class="user-entry">{{ user.id }}</span>
			<span class="user-entry">{{ user.name }}</span>

			<span class="user-entry">
				<material-button icon (click)="openEditDialog(user)">
					<material-icon icon="create"></material-icon>
				</material-button>
				<material-button icon (click)="deleteUser(user.id)">
					<material-icon icon="delete"></material-icon>
				</material-button>
			</span>
		</div>
	</div>
</section>

<modal [(visible)]="showUserDialog">
	<material-dialog headered class="headered-dialog" [error]="userDialogErrorMessage">

		<div header>
			<h1 *ngIf="dialogType == createType">Create user</h1>
			<h1 *ngIf="dialogType == editType">Edit user</h1>
		</div>

		<div>

			<div *ngIf="userDialogLoading">
				<material-progress [indeterminate]="true"></material-progress>
			</div>

			<form style="text-align: center">
				<div>
					<material-input [(ngModel)]="username" hintText="{{ 'login.username' | i18n }}"
									name="username" [disabled]="userDialogLoading"></material-input>
				</div>
				<div>
					<material-input [(ngModel)]="password" type="password" hintText="{{ 'login.password' | i18n }}"
									name="password" [disabled]="userDialogLoading"></material-input>
				</div>

				<div>
					<span *ngIf="dialogType == editType">Leave the password field empty if you don't want to change it.</span>
				</div>
			</form>

		</div>

		<div footer style="display: flex; flex-flow: row; justify-content: space-between">
			<material-button clear-size (trigger)="showUserDialog = false">
				<material-icon icon="close"></material-icon>
				Cancel
			</material-button>

			<material-button *ngIf="dialogType == createType" clear-size type="submit" (click)="createUser(username, password)">
				<material-icon icon="edit"></material-icon>
				Create
			</material-button>

			<material-button *ngIf="dialogType == editType" clear-size type="submit" (click)="editUser(username, password)">
				<material-icon icon="edit"></material-icon>
				Update
			</material-button>
		</div>

	</material-dialog>
</modal>

<modal [(visible)]="showLoadingDialog">
	<material-dialog info class="info-dialog">

		<div header class="centered-panel">
			<material-spinner></material-spinner>
		</div>

	</material-dialog>
</modal>

<modal [(visible)]="showErrorDialog">
	<material-dialog info class="info-dialog">

		<div header>
			<material-button icon autoFocus (trigger)="showErrorDialog = false">
				<material-icon icon="close"></material-icon>
			</material-button>

			<h1>An error occurred</h1>
		</div>

	</material-dialog>
</modal>